<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0b1220" />
    <title>Pomodoro Quest</title>
    <link rel="manifest" href="./manifest.json" />
    <link rel="icon" href="./assets/icon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to content</a>

    <header class="app-header" role="banner">
      <div class="brand">
        <span class="brand-mark" aria-hidden="true">‚è±</span>
        <div class="brand-text">
          <div class="brand-title">Pomodoro Quest</div>
          <div class="brand-subtitle">Focus per task. Score per day. Offline-first.</div>
        </div>
      </div>

      <nav class="top-nav" aria-label="App">
        <button class="btn btn-nav" id="openSettingsBtn" type="button">Settings</button>
      </nav>

      <div class="scoreboard" aria-label="Points">
        <div class="score">
          <div class="score-label">Total</div>
          <div class="score-value" id="totalPoints">0</div>
        </div>
        <div class="score">
          <div class="score-label">Today</div>
          <div class="score-value" id="todayPoints">0</div>
        </div>
      </div>
    </header>

    <main id="main" class="layout" role="main">
      <section class="panel tasks" aria-label="Tasks">
        <div class="panel-header">
          <h2>Tasks</h2>
          <button class="btn btn-primary" id="newTaskBtn" type="button">New</button>
        </div>

        <div class="task-list" id="taskList" role="list"></div>

        <div class="task-actions">
          <button class="btn" id="markTaskCompleteBtn" type="button">Mark complete</button>
          <button class="btn btn-danger" id="deleteTaskBtn" type="button">Delete</button>
        </div>
      </section>

      <section class="panel timer" aria-label="Pomodoro timer">
        <div class="panel-header">
          <h2>Timer</h2>
          <div class="kbd-hints" aria-label="Keyboard shortcuts">
            <span><kbd>Space</kbd> start/pause</span>
            <span><kbd>R</kbd> reset</span>
            <span><kbd>S</kbd> skip break</span>
          </div>
        </div>

        <div class="timer-core">
          <div class="phase" id="phaseLabel">Work</div>
          <div class="time" id="timeLabel" aria-live="polite">25:00</div>
          <div class="active-task" id="activeTaskLabel">No active task</div>
        </div>

        <div class="timer-controls" role="group" aria-label="Timer controls">
          <button class="btn btn-primary" id="startPauseBtn" type="button">Start</button>
          <button class="btn" id="resetBtn" type="button">Reset</button>
          <button class="btn" id="skipBreakBtn" type="button">Skip break</button>
        </div>

        <div class="timer-meta" id="timerMeta"></div>
      </section>

      <section class="panel insights" aria-label="Daily insights">
        <div class="panel-header">
          <h2>Daily points</h2>
          <div class="segmented" role="group" aria-label="Range">
            <button class="segmented-btn" id="range7" type="button">7d</button>
            <button class="segmented-btn" id="range30" type="button">30d</button>
            <button class="segmented-btn" id="rangeAll" type="button">All</button>
          </div>
        </div>

        <canvas id="pointsChart" width="800" height="260" aria-label="Points per day chart"></canvas>
        <div class="table-wrap" aria-label="Points per day table">
          <table class="points-table">
            <thead>
              <tr><th>Date</th><th>Points</th></tr>
            </thead>
            <tbody id="pointsTableBody"></tbody>
          </table>
        </div>
      </section>

    </main>

    <dialog id="taskDialog" aria-label="Task editor">
      <form method="dialog" id="taskDialogForm" class="dialog-form">
        <h3 id="taskDialogTitle">New task</h3>
        <input type="hidden" name="taskId" />
        <label>
          Title
          <input name="title" type="text" maxlength="120" required />
        </label>
        <div class="grid2">
          <label>
            Planned pomodoros
            <input inputmode="numeric" name="plannedPomodoros" type="number" min="0" max="999" step="1" required />
          </label>
          <label>
            Work override (minutes)
            <input inputmode="numeric" name="workMinutesOverride" type="number" min="0" max="180" step="1" />
          </label>
        </div>
        <menu class="dialog-actions">
          <button class="btn" value="cancel" type="button" id="cancelTaskDialogBtn">Cancel</button>
          <button class="btn btn-primary" value="confirm" type="submit">Save</button>
        </menu>
      </form>
    </dialog>

    <dialog id="settingsDialog" aria-label="Settings">
      <form method="dialog" id="settingsDialogForm" class="dialog-form settings-form">
        <div class="dialog-title-row">
          <h3>Settings</h3>
          <button class="btn" value="cancel" type="button" id="closeSettingsDialogBtn">Close</button>
        </div>

        <fieldset>
          <legend>Durations (minutes)</legend>
          <label>
            Work
            <input inputmode="numeric" name="workMinutes" type="number" min="1" max="180" step="1" required />
          </label>
          <label>
            Short break
            <input inputmode="numeric" name="shortBreakMinutes" type="number" min="1" max="60" step="1" required />
          </label>
          <label>
            Long break
            <input inputmode="numeric" name="longBreakMinutes" type="number" min="1" max="90" step="1" required />
          </label>
          <label>
            Long break interval (pomodoros)
            <input inputmode="numeric" name="longBreakInterval" type="number" min="2" max="12" step="1" required />
          </label>
        </fieldset>

        <fieldset>
          <legend>Notifications</legend>
          <label class="toggle">
            <input name="soundEnabled" type="checkbox" />
            <span>Sound on completion</span>
          </label>
          <label>
            Alarm sound
            <span class="settings-inline">
              <select name="alarmSound">
                <option value="beep">Beep</option>
                <option value="chime">Chime</option>
                <option value="dingdong">Ding-dong</option>
                <option value="buzz">Buzz</option>
                <option value="waves">Waves</option>
              </select>
              <button class="btn" id="testSoundBtn" type="button">Test</button>
            </span>
          </label>
        </fieldset>

        <div class="settings-actions">
          <button class="btn btn-primary" value="confirm" type="submit">Save</button>
        </div>

        <p class="small">
          Points: <span id="pointsRule"></span>
        </p>
      </form>
    </dialog>

    <script type="module" src="./src/main.js"></script>
  </body>
</html>
